-- Author(s): Hannes Saffrich (2024) and Marius Weidner (2025)
module Agdasubst.Examples.SystemFSub.SubstitutionPreservesTyping where

open import Agdasubst.Examples.SystemFSub.Definitions.Syntax
open import Agdasubst.Examples.SystemFSub.Definitions.Typing
open import Agdasubst.Examples.SystemFSub.Substitution

_âŠ¢â‹¯_ :
  âˆ€ {{K : Kit k}} {{TK : TypingKit K}}
    {Sâ‚ Sâ‚‚ m} {Î“â‚ : Ctx Sâ‚} {Î“â‚‚ : Ctx Sâ‚‚} {s : Sort m}
    {e : Sâ‚ âŠ¢ s} {t : Sâ‚ âˆ¶âŠ¢ s} {Ï• : Sâ‚ â€“[ K ]â†’ Sâ‚‚} â†’
  Î“â‚ âŠ¢ e âˆ¶ t â†’
  Î“â‚‚ âˆ‹*/âŠ¢*[ TK ] Ï• âˆ¶ Î“â‚ â†’
  Î“â‚‚ âŠ¢ (e â‹¯ Ï•) âˆ¶ (t â‹¯ Ï•)
_âŠ‘â‹¯_ :
  âˆ€ {{ K : Kit k }} {{ TK : TypingKit K }}
    {Ï• : Sâ‚ â€“[ K ]â†’ Sâ‚‚} â†’
  Î“â‚ âŠ¢ tâ‚ âŠ‘ tâ‚‚ â†’
  Î“â‚‚ âˆ‹*/âŠ¢*[ TK ] Ï• âˆ¶ Î“â‚ â†’
  Î“â‚‚ âŠ¢ (tâ‚ â‹¯ Ï•) âŠ‘ (tâ‚‚ â‹¯ Ï•)

âŠ‘-` tâ‚âŠ‘tâ‚‚ y tâ‚‚âŠ‘tâ‚ƒ âŠ‘â‹¯ âŠ¢Ï• = âŠ‘-` (tâ‚âŠ‘tâ‚‚ âŠ‘â‹¯ âŠ¢Ï•) (y âŠ¢â‹¯ âŠ¢Ï•) (tâ‚‚âŠ‘tâ‚ƒ âŠ‘â‹¯ âŠ¢Ï•)
âŠ‘-ğŸ™               âŠ‘â‹¯ âŠ¢Ï• = âŠ‘-ğŸ™
âŠ‘-â‡’ tâ‚âŠ‘tâ‚‚ tâ‚âŠ‘tâ‚ƒ   âŠ‘â‹¯ âŠ¢Ï• = âŠ‘-â‡’ (tâ‚âŠ‘tâ‚‚ âŠ‘â‹¯ âŠ¢Ï•) (tâ‚âŠ‘tâ‚ƒ âŠ‘â‹¯ âŠ¢Ï•)
âŠ‘-âˆ€ tâ‚âŠ‘tâ‚‚         âŠ‘â‹¯ âŠ¢Ï• = âŠ‘-âˆ€ (tâ‚âŠ‘tâ‚‚ âŠ‘â‹¯ (âŠ¢Ï• âˆ‹â†‘/âŠ¢â†‘ _))
âŠ‘-refl-var        âŠ‘â‹¯ âŠ¢Ï• = âŠ‘-refl

âŠ¢` âŠ¢x              âŠ¢â‹¯ âŠ¢Ï• = âŠ¢`/id (âŠ¢Ï• _ _ âŠ¢x)
âŠ¢Î» âŠ¢e              âŠ¢â‹¯ âŠ¢Ï• = âŠ¢Î» (âŠ¢e âŠ¢â‹¯ (âŠ¢Ï• âˆ‹â†‘/âŠ¢â†‘ _))
âŠ¢Î› âŠ¢e              âŠ¢â‹¯ âŠ¢Ï• = âŠ¢Î› (âŠ¢e âŠ¢â‹¯ ((âŠ¢Ï• âˆ‹â†‘/âŠ¢â†‘ _) âˆ‹â†‘/âŠ¢â†‘ _))
âŠ¢Â· âŠ¢eâ‚ âŠ¢eâ‚‚         âŠ¢â‹¯ âŠ¢Ï• = âŠ¢Â· (âŠ¢eâ‚ âŠ¢â‹¯ âŠ¢Ï•) (âŠ¢eâ‚‚ âŠ¢â‹¯ âŠ¢Ï•)
âŠ¢â€¢ âŠ¢tâ‚ âŠ¢tâ‚‚ tâ‚‚âŠ‘t âŠ¢e âŠ¢â‹¯ âŠ¢Ï• = âŠ¢â€¢ (âŠ¢tâ‚ âŠ¢â‹¯ ((âŠ¢Ï• âˆ‹â†‘/âŠ¢â†‘ _) âˆ‹â†‘/âŠ¢â†‘ _)) (âŠ¢tâ‚‚ âŠ¢â‹¯ âŠ¢Ï•) (tâ‚‚âŠ‘t âŠ‘â‹¯ âŠ¢Ï•) (âŠ¢e âŠ¢â‹¯ âŠ¢Ï•)
âŠ¢tt                âŠ¢â‹¯ âŠ¢Ï• = âŠ¢tt
âŠ¢â˜…                 âŠ¢â‹¯ âŠ¢Ï• = âŠ¢â˜… 
âŠ¢cstr tâ‚âŠ‘tâ‚‚        âŠ¢â‹¯ âŠ¢Ï• = âŠ¢cstr (tâ‚âŠ‘tâ‚‚ âŠ‘â‹¯ âŠ¢Ï•)
âŠ¢âŠ‘ âŠ¢e tâ‚âŠ‘tâ‚‚        âŠ¢â‹¯ âŠ¢Ï• = âŠ¢âŠ‘ (âŠ¢e âŠ¢â‹¯ âŠ¢Ï•) (tâ‚âŠ‘tâ‚‚ âŠ‘â‹¯ âŠ¢Ï•)

open TypingTraversal (mkTTraversal _âŠ¢â‹¯_) hiding (_âŠ¢â‹¯_) public