\documentclass[dvipsnames,aspectratio=169,pdftex]{beamer}
\usepackage{agda}
\usepackage{stmaryrd}
\usepackage{xcolor}
\usepackage{txfonts}
\usepackage[T1]{fontenc}
\usepackage{microtype}
\DisableLigatures[-]{encoding=T1}
\usepackage{tikz}
\usetikzlibrary{cd}


\input{agda-generated}
\input{agda-generated-examples}
\input{unicodeletters}
\input{agdamacros}

\definecolor{agdablue}{HTML}{0000CD}
\definecolor{agdagreen}{HTML}{008B00}
\DisableLigatures[-]{encoding=T1}
\newcommand{\tdot}{\mkern2mu \textcolor{agdablue}{\cdotp} \mkern-2mu \textcolor{agdablue}{\cdotp} \mkern-2mu \textcolor{agdablue}{\cdotp} \mkern1mu}
\newcommand{\Tdot}{\mkern2mu {\cdotp} \mkern-2mu  {\cdotp} \mkern-2mu {\cdotp} \mkern1mu}



% Define University of Freiburg colors
\definecolor{UFRBlue100}{RGB}{52, 74, 154}    % #344A9A
\definecolor{UFRBlue80}{RGB}{82, 101, 164}    % #5265A4
\definecolor{UFRBlue60}{RGB}{112, 128, 178}   % #7080B2
\definecolor{UFRBlue40}{RGB}{143, 156, 191}   % #8F9CBF
\definecolor{UFRBlue20}{RGB}{173, 183, 205}   % #ADB7CD
\definecolor{UFRBlack}{RGB}{0, 0, 0}          % #000000
\definecolor{UFRWhite}{RGB}{255, 255, 255}    % #FFFFFF
\definecolor{UFRSand100}{RGB}{246, 241, 227}  % #F6F1E3
\definecolor{UFRSand50}{RGB}{250, 248, 241}   % #FAF8F1
\definecolor{UFRGreen100}{RGB}{0, 160, 130}   % #00A082
\definecolor{UFRGreen80}{RGB}{51, 179, 155}   % #33B39B
\definecolor{UFRGreen60}{RGB}{102, 198, 180}  % #66C6B4
\definecolor{UFRGreen40}{RGB}{153, 217, 205}  % #99D9CD
\definecolor{UFRGreen20}{RGB}{204, 236, 230}  % #CCECE6
\definecolor{UFRBrown100}{RGB}{143, 107, 48}  % #8F6B30
\definecolor{UFRBrown80}{RGB}{165, 137, 89}   % #A58959
\definecolor{UFRBrown60}{RGB}{186, 166, 130}  % #BAA682
\definecolor{UFRBrown40}{RGB}{208, 196, 171}  % #D0C4AB
\definecolor{UFRBrown20}{RGB}{229, 226, 211}  % #E5E2D3
\definecolor{UFRRosa100}{RGB}{255, 0, 120}    % #FF0078
\definecolor{UFRRosa80}{RGB}{255, 51, 140}    % #FF338C
\definecolor{UFRRosa60}{RGB}{255, 102, 160}   % #FF66A0
\definecolor{UFRRosa40}{RGB}{255, 153, 180}   % #FF99B4
\definecolor{UFRRosa20}{RGB}{255, 204, 200}   % #FFCCC8
\definecolor{UFRYellow100}{RGB}{255, 200, 10} % #FFC80A
\definecolor{UFRYellow80}{RGB}{255, 210, 51}  % #FFD233
\definecolor{UFRYellow60}{RGB}{255, 221, 92}  % #FFDD5C
\definecolor{UFRYellow40}{RGB}{255, 231, 133} % #FFE785
\definecolor{UFRYellow20}{RGB}{255, 242, 174} % #FFF2AE

\usetheme{Madrid}

% Set Beamer color scheme
\setbeamercolor{normal text}{fg=UFRBlack, bg=UFRSand50} % Main text with sand background
\setbeamercolor{structure}{fg=UFRBlue100} % Structural elements in primary blue
\setbeamercolor{alerted text}{fg=UFRRosa100} % Alerts in primary rosa
\setbeamercolor{frametitle}{fg=UFRWhite, bg=UFRBlue100} % Frame titles with blue background
\setbeamercolor{title}{fg=UFRWhite, bg=UFRBlue100} % Title slide with blue background
\setbeamercolor{item}{fg=UFRBlue100} % Bullet points in primary blue
\setbeamercolor{subitem}{fg=UFRBlue80} % Sub-bullets in lighter blue
\setbeamercolor{block title}{fg=UFRWhite, bg=UFRGreen100} % Block titles with green background
\setbeamercolor{block body}{fg=UFRBlack, bg=UFRGreen20} % Block body with light green background
\setbeamercolor{example text}{fg=UFRBrown100} % Example text in primary brown
\setbeamercolor{section in toc}{fg=UFRBlue100} % Table of contents sections in blue
\setbeamercolor{subsection in toc}{fg=UFRBlue80} % Subsections in TOC in lighter blue
\setbeamercolor{button}{fg=UFRWhite, bg=UFRRosa100} % Buttons in primary rosa

% Yellow is now used for special highlighting
\setbeamercolor{note}{fg=UFRBlack, bg=UFRYellow40} % Notes in light yellow

\newcommand{\SubItem}[1]{
    {\setlength\itemindent{15pt} \item[-] #1}
}

\AtBeginSection[]{%
  \begin{frame}<beamer>
    \frametitle{Outline}
    \tableofcontents[currentsection]%[sectionstyle=show/show,subsectionstyle=hide/show/hide]
  \end{frame}
  \addtocounter{framenumber}{-1}% If you don't want them to affect the slide number
}

\title{Automated and Mechanized Reasoning over Substitutions and Syntaxes with Binding}
\author{Marius Weidner}
\institute{University of Freiburg}
\date{\today \ (Kolloqium, Freiburg)}

\begin{document}

\begin{frame}{\null}
  \titlepage{}
\end{frame}
% 1) Syntaxes with Binding -> Programming Languages that support variables (and thus need substitutions)
% 2) Mechanized -> we want all of the following to apply to proof assistants, even though we rarly mention them
% 3) Automated -> solve between syntax and substitutions automatically
%    Terms with binding and substitution are sometimes equal,
%    but the proof assistant cannot conclude them to be. we want an automatic procedure, that enables the 
%    proof assistant to see that two terms are equal, if they are.

\begin{frame}[fragile]
  \frametitle{Substitution and Alpha Equivalence via de Bruijn}
  \begin{itemize}
    \item $\alpha$-equivalence via de Bruijn
          \[
            \lambda x. \lambda y.\,x \,y \quad\equiv\quad \lambda.\,\lambda.\,1\,0
          \]

    \item Parallel de Bruijn Substitutions
          \[
            (\lambda x. \lambda y. M)\,N\,L \quad\equiv\quad M[x := N][y := L]  \quad \equiv\quad M[x := N, y := L] \quad\equiv\quad M \Tdot (N \cdot L \cdot id)
          \]
  \end{itemize}

  \vspace{0.6em}
  \begin{block}{Substitution Lemma [Barendgredt (1984)]}
    For all terms $M, N, L$:
    \[
      M[x := N][y := L] \quad\equiv\quad M[y := L][x := N[y := L]]. % chktex 44
    \]
  \end{block}
\end{frame}

% 1) Einfachste Model Sprache, aber wir wollen vermeiden Variablen umbennen zu müssen
% 1.5) Debruijn vermeidet das problem, dass variablen namen uns für syntactic equality im weg stehen
% 2) Parallel substitutionen sind einfach Maps, von Variablen zu Termen
% 3) Substitutions lemma als Motivation für automatic solving
% -> we need rules, to automatically solve those equations!

\begin{frame}[fragile]
  \frametitle{Explicit Substitution Calculi: Symbols of the Sigma Calculus}
  \begin{minipage}[t]{0.48\textwidth}
    \raggedright{}
    \textbf{Variables} $x$
    \begin{align*}
      \text{innermost variable} \quad & \textcolor{agdagreen}{\mathsf{zero}}    \\
      \text{outer variables} \quad    & \textcolor{agdagreen}{\mathsf{suc}}\; x
    \end{align*}\\
    \vspace{1em}
    \textbf{Terms} $t$
    \begin{align*}
      \text{variable usage} \quad           & \textcolor{agdagreen}{\texttt{\`{}}}x \\
      \text{abstraction} \quad              & \textcolor{agdagreen}{λ.}\, t         \\
      \text{application} \quad              & t_1 \textcolor{agdagreen}{\cdot}t_2   \\
      \text{substitution lookup} \quad      & x \textcolor{agdablue}{\;\&\;} σ      \\
      \text{substitution application} \quad & t \tdot{} σ
    \end{align*}
  \end{minipage}
  \hfill
  \begin{minipage}[t]{0.48\textwidth}
    \raggedright{}
    \textbf{Substitutions} $σ$
    \begin{align*}
      \text{identity} \quad    & \textcolor{agdablue}{\mathsf{id}}    \\
      \text{weakening} \quad   & \textcolor{agdablue}{\mathsf{wk}}    \\
      \text{extension} \quad   & t \textcolor{agdablue}{\cdot} σ      \\
      \text{composition} \quad & σ_1 \ \textcolor{agdablue}{;} \  σ_2 \\
    \end{align*}
  \end{minipage}
\end{frame}

% Variables, Terms Substitutions (dont explain weakening)
% green are actual symbols, blue are too, for now! 

\begin{frame}[fragile]
  \frametitle{Laws of the Sigma Calculus}
  \textbf{Definitional Laws (Excerpt)}
  \begin{alignat*}{2}
    \mathsf{id}      \quad          & x \textcolor{agdablue}{\;\&\;} \textcolor{agdablue}{\mathsf{id}}                                      &  & = \textcolor{agdagreen}{\texttt{\`{}}} x \\
    \mathsf{ext}_\mathsf{Z}  \quad  & \textcolor{agdagreen}{\mathsf{zero}} \textcolor{agdablue}{\;\&\;} (t \textcolor{agdablue}{\cdot} σ)   &  & = t                                      \\
    \mathsf{ext}_\mathsf{S}   \quad & \textcolor{agdagreen}{\mathsf{suc}}\;x \textcolor{agdablue}{\;\&\;} (t \textcolor{agdablue}{\cdot} σ) &  & = x \textcolor{agdablue}{\;\&\;} σ
  \end{alignat*}
  \textbf{Interaction Laws (Excerpt)}
  \begin{alignat*}{2}
    \mathsf{comp\text{-}id}_\mathsf{L} \quad & \textcolor{agdablue}{\mathsf{id}} \ \textcolor{agdablue}{;} \  σ        &  & \equiv σ                                                                        \\
    \mathsf{comp\text{-}id}_\mathsf{R} \quad & σ \ \textcolor{agdablue}{;} \  \textcolor{agdablue}{\mathsf{id}}        &  & \equiv σ                                                                        \\
    \mathsf{associativity}          \quad    & (σ_1 \ \textcolor{agdablue}{;} \  σ_2) \ \textcolor{agdablue}{;} \  σ_3 &  & \equiv  σ_1 \ \textcolor{agdablue}{;} \  (σ_2 \ \textcolor{agdablue}{;} \  σ_3)
  \end{alignat*}
\end{frame}

\begin{frame}[fragile]
  \frametitle{The Sigma Calculus: Discussion}
  \begin{itemize}
    \item Explicit syntactic symbols for variables, terms, and substitutions
    \item Governed by reduction rules describing their interaction
  \end{itemize}

  \begin{theorem}
    The laws of the $\sigma$-calculus yield a \textbf{terminating},
    \textbf{confluent}, and \textbf{complete} decision procedure for equality:
    two terms $M, N$ are equal iff their normal forms, obtained by exhaustively
    applying the reduction rules, are equal.
  \end{theorem}

  \vspace{1em}
  \textbf{Idea.}
  \begin{enumerate}
    \item Prove the $\sigma$-calculus laws for a given syntax and substitution model in
          Agda
    \item Register the laws as native reduction rules
    \item Avoids the need to explicitly state and invoke, for example the Substitution
          Lemma
  \end{enumerate}
\end{frame}

\begin{frame}[fragile]
  \frametitle{A Model for our Algebra: Parallel Substitutions as Functions}
  Substitutions can be modeled as functions
  \[
    \sigma : \text{Variable} \to \text{Term}
  \]

  \noindent\begin{minipage}[t]{0.48\linewidth}
    \raggedright{}
    \EYSLookUp{}
  \end{minipage}
  \hfill
  \begin{minipage}[t]{0.48\linewidth}
    \raggedright{}
    \EYSId{}
  \end{minipage}

  However, some definitions cannot be stated structurally recursively.

  As a solution, we introduce a special case of substitutions, called
  \textbf{renamings}
  \[
    \rho : \text{Variable} \to \text{Variable}
  \]

  \noindent\begin{minipage}[t]{0.48\linewidth}
    \raggedright{}
    \EYRLookUp{}
  \end{minipage}
  \hfill
  \begin{minipage}[t]{0.48\linewidth}
    \raggedright{}
    \EYRId{}
  \end{minipage}
\end{frame}

\begin{frame}[fragile]
  \frametitle{The Sigma Calculus Laws with First-Class Renamings}
  New symbols for renamings demand additional laws
  \EAssoc{}
  and even a whole new category of laws:
  \textbf{Coincidence Laws}
  \ECoincidenceLaw{}
\end{frame}

\begin{frame}[fragile]
  \frametitle{The Sigma Calculus with First-Class Renamings: Discussion}
  \begin{itemize}
    \item The variant with first-class renamings can be modeled in Agda
    \item We deliberately hide the underlying models of renamings/substitutions from Agda
    \item and instruct Agda to reduce stuck terms by applying the $\sigma$-calculus laws
    \item Drawbacks:
          \begin{enumerate}
            \item Completeness is lost
            \item Many additional laws of similar shape
            \item Results involving substitutions must be proved twice: once for renamings and
                  then for substitutions
          \end{enumerate}
  \end{itemize}

  \vspace{1em}
  \textbf{Idea.}
  Introduce new syntactic categories for
  \begin{itemize}
    \item Variables \emph{or} Terms: \textbf{Kits} $x/t$
    \item Renamings \emph{or} Substitutions: \textbf{Maps} $\varphi$
  \end{itemize}
\end{frame}

\begin{frame}[fragile]
  \frametitle{The Laws of the Sigma Calculus with Kits and Maps: Extension}
  The original definitional law for extension, separately stated for renamings and substitutions:
  \noindent\begin{minipage}[t]{0.48\linewidth}
    \raggedright{}
    \EDefLawsA{}
  \end{minipage}
  \hfill
  \begin{minipage}[t]{0.48\linewidth}
    \raggedright{}
    \EDefLawsB{}
  \end{minipage}\\
  can be unified with Kits and Maps:
  \EExtLaws{}
  where  $K \in \{\AgdaFunction{V}, \AgdaFunction{T}\}$
\end{frame}

\begin{frame}[fragile]
  \frametitle{The Laws of the Sigma Calculus with Kits and Maps: Associativity}
  The Map based associativity law:
  \EEAssoc{}
  where $\sqcup$ refers to the join-semilattice on $\{\AgdaFunction{V},
    \AgdaFunction{T}\}$ generated by $\AgdaFunction{V} <  \AgdaFunction{T}$:
  \ETypeLevel{}
\end{frame}

\begin{frame}[fragile]
  \frametitle{Kit and Map Based Sigma Calculus: Discussion}
  \begin{itemize}
    \item Unified laws for variables/terms and renamings/substitutions
    \item Syntactic differences of the similar in shape symbols delegated to type level
    \item Structural dependence hidden from user
    \item Also uses rewriting on the type-level, e.g.\ lattice laws
    \item Agda can automatically infer the type-level markers
  \end{itemize}
\end{frame}

\begin{frame}[fragile]
  \frametitle{The End and What We Have Not Discussed}
  \begin{itemize}
    \item A model for the Kit and Map based $\sigma$-calculus
    \item How to formulate the Kit and Map based rules such that they are admissible for
          rewriting
    \item Adaption to custom syntaxes
    \item Proofs that actually use the presented lawse
    \item Comparison to related work
  \end{itemize}
\end{frame}

\begin{frame}[fragile]
  \frametitle{[Bonus] A Model for our Algebra: Parallel Substitutions as Functions}
  Substitutions are modeled as functions $\sigma \in (\text{Variable} \to \text{Term})$
  \noindent\begin{minipage}[t]{0.48\linewidth}
    \raggedright{}
    \EXLookUp{}
    \EXId{}
    \EXWk{}
    \EXExt{}
  \end{minipage}
  \hfill
  \begin{minipage}[t]{0.48\linewidth}
    \raggedright{}
    \ESRFail{}
    Problem: Termination checking fails..
  \end{minipage}
\end{frame}

\begin{frame}[fragile]
  \frametitle{[Bonus] A Model for our Algebra: Parallel Substitutions as Functions (Cont.)}
  Solution: We need to define \AgdaFunction{wk} in terms of renamings $\rho \in (\text{Variable} \to \text{Variable})o$!
  \noindent\begin{minipage}[t]{0.48\linewidth}
    \raggedright{}
    \EYRLookUp{}
    \EYRId{}
    \EYRExt{}
    \EYRWk{}
  \end{minipage}
  \hfill
  \begin{minipage}[t]{0.48\linewidth}
    \raggedright{}
    \EYSCompR{}
    \EYSLift{}
    \EYSTrav{}
  \end{minipage}
\end{frame}

\begin{frame}[fragile]
  \frametitle{[Bonus] A Model for our Algebra: General Final Associativity Law}
  \AAssocTryT{}
\end{frame}

\end{document}